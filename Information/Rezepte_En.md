# Information about the recipes

In the following, the individual recipe segments, the structure and the outsourcing of these recipes are shown and explained.

## Last change

The last change of this description was: August 25, 2024

## Existing recipe segments

The recipes depend on the device. Except for the Eurotherm device, all recipes are structured the same. There are therefore the following types of recipe segments:

s 	- jump  
r 	- ramp

Eurotherm temperature specific:    
er 	- Eurotherm's own ramp  
op 	- jump in performance in a temperature recipe  
opr - release ramp in a temperature recipe  

For Eurotherm power, PID mode, TruHeat, Nemo drives (stroke, rotation) and PI axis only s and r are available!

```
Jump:               SN: t ; ST  ; s
Ramp:               SN: t ; TS  ; r   ; RTI
Eurotherm ramp:     SN: t ; TS  ; er  ; m
Power Jump:         SN: t ; STT ; op  ; STP
Power ramp:         SN: t ; TST ; opr ; TSP; RTI ; SVR
```
Legend:
- SN - step number
- t - segment time
- ST - setpoint
- STT - setpoint temperatur
- STP - setpoint power
- TS - target setpoint
- TST - target setpoint temperatur
- TSP - target setpoint power
- RTI - ramp jump time interval
- m - pitch
- SVR - start value ramp

### Description:
1. Time: 			
    - The segment lasts in seconds
2.  Setpoint: 			
    - Value to which the jump should be made.
3.  Target setpoint: 		
    - end of ramp
4. Pitch: 			
    - steepness of the ramp
	    - er: e.g. 0.01 --> transfer to Eurotherm, meaning 0.01°C/s
        - Calculation: m = delta y / delta x
            - e.g. recipe: `n1: 600 ; 200 ; er ; 0.297` with a starting temperature of 25°C
            - m = (200°C - 25°C)/ 600 s = 0.297 °C/s
5. Ramp jump time interval: 	
    - Distance between the ramp jumps
    - Examples:
	    - r:   
            - Specification in Config: 1 s 
            - with time = 10 s and target setpoint = 100°C 
            - starting temperature: 30°C   
            -> 10 s/1 s = 10   
            -> (100°C - 30°C)/10 s = 7 °C (jumps)   
            -> A jump every second
	    - opr: 
            - Specification in Config: 2 s 
            - with time = 10 s and target setpoint = 100 %
            - start power: 0 %    
            -> 10 s/2 s = 5     
            -> (100 % -  0 %)/5 s  = 20 % (jumps)    
            -> A jump every 2 seconds
6. Start value: 			
    - start of the ramp

## Particularities:
- Performance recipes at Eurotherm are generated by s and r. If a performance is to be changed in a temperature recipe, then op and opr are used there.
- In the case of "power jump" the ACTUAL value can also be specified in the "setpoint power". This only switches the Eurotherm mode to manual. The current power value is kept as the actual value/setpoint.
- For "Power ramp" nothing can be specified for "Start value ramp", then the power ramp starts at zero.
- A temperature jump is also triggered with "power jump" and "power ramp".

## Outsourcing of recipes

The folder **rezepte** is intended for VIFCON recipes. The format of these files is Yaml (.yml).
These recipes are called from the config file as follows:

```
dat: file name
```

The **dat** must be included. The configuration of the recipes can now also be carried out via a separate file. For this purpose, three things must be adhered to:
1. step must be called 'dat'!
2. Recipe file must be in the 'vifcon/rezepte/' folder!
3. Only the steps can be in the file!
4. The normal config recipe steps must never be called dat!

In the folder *rezepte* you will find the example file [rec_example.yml](../vifcon/rezepte/rec_example.yml), which contains a file with the explanations found here.

## Examples

1. Configure recipe in config file:
    ``` 
    device:
        Eurotherm:
            # Sonstige Einstellungen
            rezepte:
                Test_Recipe_1:  
                    n1: 600 ; 100 ; r ; 100
                Test_Recipe_2:
                    n1: 600 ; 100 ; r ; 10
                Test_Recipe_3:    
                    dat: rec_example.yml
    ```

The only thing you need to pay attention to here is the indentation so that everything can be read correctly.

2. Configure the swapped file:
    - rec_example.yml:
        ```
        n0: 3600 ; 500 ; er  ; 0.133
        n1: 600  ; 500 ; s 
        n2: 600  ; 500 ; op  ; 20
        n3: 1200 ; 200 ; r   ; 3
        n4: 600  ; 200 ; opr ; 5 ; 1 ; 20 
        n5: 600  ; 20  ; er  ; 0.3
        ```

This file does not require indentation. Comments can be created in these files, but note that certain characters such as "\t" do not appear outside of the comments!

---

**Test_Recipe_1:**

<img src="../Bilder/Beispiel_Rezept_1.png" alt="Recipe Example 1" title='Recipe Example 1 - r-Segment' width=700/>

In the example, only one r-segment is created. The *Test_Recipe_2* is used to show the use of the r-segment part *Ramp jump time interval*. The last number therefore indicates the accuracy or the frequency of the setpoint jumps in this segment. The smaller the number, the more the segment resembles a linear function.

**WARNING**: Jumps are the biggest stress on a system. When using this type of ramp, sufficient testing should be carried out to ensure that it works safely with the system. With the Eurotherm controller, poor or incorrectly configured control could cause peaks in the output power at each jump!!

---

**Test_Recipe_2:**

<img src="../Bilder/Beispiel_Rezept_2.png" alt="Recipe Example 2" title='Recipe Example 2 - r-Segment' width=700/>

--- 

**Test_Recipe_3:**

The example also shows with n0 to n5 what it should look like in the config file. The user can specify where the recipe should be! The example shown can be found in figure [Beispiel_Rezept_3.png](../Bilder/Beispiel_Rezept_3.png) and can be seen below.

All 5 segment types are used in the example. This means that it is a Eurotherm controller. The recipe shown here is also part of the [Config-Templates](../Template/config_temp.yml).

<img src="../Bilder/Beispiel_Rezept_3.png" alt="Recipe Example 3" title='Recipe Example Eurotherm 1' width=700/>

---

**More examples:**

Recipe:

```
n1: 10 ; 100 ; er ; 8
n2: 10 ; 100 ; s
n3: 10 ; 200 ; r ; 0,667
n4: 10 ; 200 ; op ; 20
n5: 10 ; 200 ; opr ; 0 ; 0,667 ; 20
```
Plot:   
<img src="../Bilder/Beispiel_Rezept_4.png" alt="Recipe Example 4" title='Recipe Example Eurotherm 2' width=700/>

This recipe is similar to *Test_Recipe_3*. There is now manual labeling of the individual segments. 

---

Recipe:
```
n1: 600 ; 100 ; s
n2: 600 ; 50 ; op ; 10
n3: 600 ; 20 ; s
```
Plot:    
<img src="../Bilder/Beispiel_Rezept_5.png" alt="Rezept Beispiel 5" title='Rezept Beispiel Eurotherm 3' width=700/>

The example is intended to show that it is possible to carry out a temperature jump for op and opr.

---

Recipe:
```
n1: 1 ; -2 ; s
n2: 4 ; -1 ; s
n3: 1 ; -0.5 ; s
n4: 1 ; 1 ; s
n5: 5 ; 2 ; s
```
Plot:    
<img src="../Bilder/Beispiel_Rezept_6.png" alt="Rezept Beispiel 6" title='Rezept Beispiel PI-Achse' width=700/>

This recipe can also be found in the [template of the config file](../Template/config_temp.yml). This recipe is for the PI axis, for example.

